<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- ICONS -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <!-- STYLESHEET -->
  <link rel="stylesheet" href="../css/dashCss/dash.css" />

  <!-- bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" />

  <!-- bootstrap Select CSS -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />

  <!-- icone nav bar -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>



  <link rel="stylesheet" href="../css/dashCss/dash.css" />

  <!-- AnyChart Scripts -->
  <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-base.min.js"></script>
  <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-tag-cloud.min.js"></script>


  <!-- scripts do Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- icone font awesom -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


  <title>Relatório-Gerente</title>
</head>

<body>
  <div class="container">
    <div class="sidebar">
      <div class="menu-btn">
        <i class="ph-bold ph-caret-left"></i>
      </div>
      <div class="head">
        <div class="user-img">
          <img src="../assets/imgs/contact.png" alt="" />
        </div>
        <div class="user-details">
          <p class="title" id="cargoUsuario"></p>
          <p class="name" id="nomeUsuario"></p>
        </div>
      </div>
      <div class="nav">
        <div class="menu">
          <p class="title">Menu</p>
          <ul>
            <ul class="sub-menu">
              <li>
                <a href="#">
                  <span class="text">Users</span>
                </a>
              </li>
              <li>
                <a href="#">
                  <span class="text">Subscribers</span>
                </a>
              </li>
            </ul>
            </li>
            <li class="active">
              <a href="">
                <i class="icon ph-bold ph-file-text"></i>
                <span class="text">Relatório</span>
              </a>
            </li>
            <li>
              <a href="dashGerente01.html">
                <i class="icon ph-bold ph-chart-bar"></i>
                <span class="text">Gráfico</span>
              </a>
            </li>
            <li>
              <a href="cadastroServidor.html">
                <i class="icon ph-bold ph-gear"></i>
                <span class="text">Cadastrar Servidor</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="menu">
          <p class="title"></p>
          <ul>
            <li>

            </li>
          </ul>
        </div>
      </div>
      <div class="menu">
        <p class="title">Conta</p>
        <ul>
          <li>
            <a href="../index.html">
              <i class="icon ph-bold ph-sign-out"></i>
              <span class="text">Sair</span>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <div class="creditsG">
      <div class="relatorioG">
        <div class="parteSuperior">
          <div class="containerSUP">
            <div class="supE">
              <div class="supTitulo">
                <h1>Feriados Globais Mais Populares:</h1>

              </div>
              <div class="supImg">
                <div class="supImg1">
                  <div class="wrapper">
                    <i class="fa-solid fa-circle-question" style="font-size: 23px;"></i>
                    <div class="tooltip">Na nuvem de palavras, os feriados mais populares são exibidos com palavras
                      maiores, refletindo sua maior popularidade.</div>
                  </div>

                </div>
                <div class="supImg2">
                  <!-- Div para exibir a Word Cloud -->
                  <div id="word" style="width: 450px; height: 195px;"></div>

                </div>


              </div>
            </div>
            <div class="supD">
              <div class="supTitulo">
                <h1>Top 5 Feriados vs Uso Médio de CPU (%) no servidor: </h1>
                <select id="feriadoSelect" onchange="obterServidorSelecionado()"></select>
              </div>
              <div class="graficoWord">
                <div class="graficoWord1">
                  <div id="grafico"></div>
                </div>
                <div class="graficoWord2">
                  <div class="wrapper">
                    <i class="fa-solid fa-circle-question" style="font-size: 23px;"></i>
                    <div class="tooltip">Cada barra do gráfico representa o percentual de uso médio da CPU durante os
                      feriados, permitindo comparar como o desempenho do servidor variou em diferentes datas festivas,
                      com foco nas mais significativas.</div>
                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>
        <div class="parteInferior">
          <div class="containerINF">
            <div class="divisao1">
              <div class="divcima">
                <select class="selectpicker" data-none-selected-text="Servidor" id="servidorRelatorio"
                  onchange="obterServidorRelatorio()" multiple data-live-search="true">

                </select>
                <select class="selectpicker" data-none-selected-text="Período" id="periodoRelatorio"
                  onchange="obterPeriodoRelatorio()" multiple data-live-search="true">

                </select>

                <select class="selectpicker" data-none-selected-text="Componente" id="componenteRelatorio"
                  onchange="obterComponenteRelatorio()" multiple data-live-search="true">
                  <option>Uso da CPU</option>
                  <option>Uso da RAM</option>
                  <option>Dados enviados da rede</option>
                  <option>Dados recebidos da rede</option>

                </select>

              </div>

              <div class="divbaixo">
                <button class="buttonRelatorioAnalisar" onclick="analisar()">Analisar</button>
                <button class="buttonRelatorioComparar" onclick="comparar()">Comparar</button>
              </div>


            </div>
            <div class="divisao2" id="divisao2">

              <div class="ranking">
                <table id="tablee">
                  <thead>
                    <tr id="trr"> <!-- titulo do cabeçalho, primeira linha -->
                      <th id="thh">Servidor</th> <!-- cabeçalho da primeira coluna -->
                      <th id="thh">Total de Alertas</th> <!-- cabeçalho da segunda coluna -->
                      <th id="thh">Componente</th>
                      <th id="thh">Relação com o Limite</th>
                      <th id="thh">Mês</th>
                    </tr>
                  </thead>
                  <tbody id="ranking">

                    <!--  corpo da tabela, ou seja, é a parte do ranking -->
                    <!-- as linhas da tabela serão adicionadas dinamicamente pelo JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>

            <div class="divisao2C" id="divisao2C" display="none">
              <div class="DE" id="DE">
                <div id="grafico2">

                </div>
                <div id="grafico"></div>
              </div>

              <div class="DD" id="DD">

                <div class="comp">

                </div>

              </div>
            </div>



          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <!-- Bootstrap Bundle com o Popper.js -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>

  <!-- Bootstrap Select JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>



  <script>
    var nomeUsuario = sessionStorage.getItem("NOME_USUARIO");
    var cargoUsuario = sessionStorage.getItem("CARGO");


    document.getElementById('nomeUsuario').textContent = nomeUsuario;
    document.getElementById('cargoUsuario').textContent = cargoUsuario;

    const feriadosTraduzidos = {
      "NewYearsDay": "Ano Novo",
      "ChristmasDay": "Natal",
      "GoodFriday": "Sexta-feira Santa",
      "EasterMonday": "Páscoa",
      "LabourDay": "Dia do Trabalho",
      "IndependenceDay": "Independência",
      "St.StephensDay": "Santo Estêvão",
      "EasterSunday": "Domingo de Páscoa",
      "AllSaintsDay": "Dia de Todos os Santos",
      "AscensionDay": "Dia da Ascensão",
      "WhitMonday": "Segunda-feira de Pentecostes",
      "Epiphany": "Dia de Reis",
      "AssumptionDay": "Assunção de Maria",
      "Carnival": "Carnaval",
      "ChristmasEve": "Véspera de Natal",
      "CorpusChristi": "Corpus Christi",
      "RegionalHoliday": "Feriado Regional",
      "MaundyThursday": "Quinta-feira Santa",
      "ImmaculateConception": "Imaculada Conceição",
      "NewYearsEve": "Véspera de Ano Novo"
    };

    // Array para armazenar os feriados
    const feriados = [];
    const periodos = [];




    // Função para buscar dados dos feriados
    async function fetchFeriados() {
      console.log('Iniciando a requisição para /dashboard/wordcloud');

      try {
        const response = await fetch('/dashboard/wordcloud', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
          },
        });

        console.log('Resposta recebida do servidor:', response);

        // Verifica se a resposta foi bem-sucedida
        if (!response.ok) {
          throw new Error('Erro ao obter os dados dos feriados: ' + response.statusText);
        }

        const data = await response.json();
        console.log('Dados brutos recebidos:', data);

        //  Itera sobre o array 'data' onde possui o nomeFeriado e a frequencia. Acessa o objeto de string e acessa a entidade relacionada a o nome do feriado em inglês e acessa o item com o nome do feriado traduzido armazenando no x caso o nome em ingles nao seja encontrado no objeto ele mantém o nome em inglês
        data.forEach(item => {
          feriados.push({
            x: feriadosTraduzidos[item.nomeFeriado] || item.nomeFeriado, // traduz ou mantém o nome original
            value: item.frequencia // 'value' para a frequência
          });
        });

        console.log('Feriados processados:', feriados);
        createWordCloud(feriados);
      } catch (error) {
        console.error('Erro na requisição dos feriados:', error);
      }
    }

    // Função para criar a nuvem de palavras
    function createWordCloud(feriados) {
      console.log('Criando a word cloud com os seguintes feriados:', feriados);

      // ordena os feriados pela frequência (valor) de forma decrescente
      var topFeriados = feriados.sort(function (a, b) {
        return b.value - a.value;  // decrescente 
      }).slice(0, 10);

      var chart = anychart.tagCloud(topFeriados);

      // cores da escala
      var customColor = anychart.scales.linearColor();
      customColor.colors(["#45b6fe", '#f94449', "#DE73FF"]);
      chart.colorScale(customColor);

      chart.angles([0, 23, -23]);
      chart.colorRange(true);
      chart.colorRange().length('90%');

      chart.scale(anychart.scales.linear());


      chart.fontSize(function () {
        //  palavras com frequências maiores possuem fontes maiores
        return Math.min(8 + (this.value / 100) * 21, 32);
      });

      chart.tooltip().format(function () {
        // Personaliza o conteúdo do tooltip
        return 'Frequência: ' + this.value;
      });

      chart.container('word');
      chart.draw();

      console.log('Word cloud criada com sucesso!');
    }


    fetchFeriados();


  </script>

</body>

</html>
<script src="../js/script.js"></script>
<script>

  var componenteSelecionado = [];
  var servSelecionado = [];
  var peridoSelecionado = [];

  function obterServidorRelatorio() {
    servSelecionado = [];
    const select = document.getElementById("servidorRelatorio");

    for (let i = 0; i < select.selectedOptions.length; i++) {
      servSelecionado.push(select.selectedOptions[i].value);
    }
    return servSelecionado
    console.log("Servidores selecionados:", servSelecionado);
  }

  function obterPeriodoRelatorio() {
    peridoSelecionado = [];
    const select = document.getElementById("periodoRelatorio");

    const mes = {
      "Janeiro": 1,
      "Fevereiro": 2,
      "Março": 3,
      "Abril": 4,
      "Maio": 5,
      "Junho": 6,
      "Julho": 7,
      "Agosto": 8,
      "Setembro": 9,
      "Outubro": 10,
      "Novembro": 11,
      "Dezembro": 12
    }

    for (let i = 0; i < select.selectedOptions.length; i++) {
      const nomeMes = select.selectedOptions[i].value;
      peridoSelecionado.push(mes[nomeMes]);
    }
    return peridoSelecionado
    console.log("periodos selecionados:", peridoSelecionado);

  }

  function obterComponenteRelatorio() {
    componenteSelecionado = [];
    const select = document.getElementById("componenteRelatorio");

    const componente = {
      "Uso da CPU": "cpu",
      "Uso da RAM": "ram",
      "Dados enviados da rede": "rede_recebida",
      "Dados recebidos da rede": "rede_enviada"
    }
    for (let i = 0; i < select.selectedOptions.length; i++) {
      nomeComponente = select.selectedOptions[i].value
      componenteSelecionado.push(componente[nomeComponente]);
    }
    return componenteSelecionado
    console.log("componentes selecionados:", componenteSelecionado);
  }

  function gerarQueryParams() {
    const servidores = obterServidorRelatorio();
    const periodos = obterPeriodoRelatorio();
    const componentes = obterComponenteRelatorio();

    const queryParams = new URLSearchParams();
    queryParams.append('servidores', JSON.stringify(servidores));
    queryParams.append('periodos', JSON.stringify(periodos));
    queryParams.append('componentes', JSON.stringify(componentes));

    return queryParams.toString();
  }


  cont = 0

  function comparar() {
    const comparacao = document.getElementById('comp');
    const compararButton = document.querySelector(".buttonRelatorioComparar");
    const analisarButton = document.querySelector(".buttonRelatorioAnalisar");
    const queryParams = gerarQueryParams();

    analisarButton.classList.remove("clicked");

    if (cont == 0 || !compararButton.classList.contains("clicked")) {
      compararButton.classList.add("clicked");
      cont = 1;


      // if (servidores.length > 2) {
      //   alert("Escolha apenas 2 servidores!", servidores.length)

      // } else if (servidores.length == 1) {
      //   alert("Escolha apenas mais 1 servidor!")
      // }

      document.getElementById("divisao2").style.display = 'none';
      document.getElementById("divisao2C").style.display = 'flex';
      document.getElementById("DD").style.display = 'flex';
      document.getElementById("DE").style.display = 'flex';
      document.getElementById("grafico2").style.display = 'flex';

      fetch(`/dashboard/comparar?${queryParams.toString()}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => {
          // Verifica
          if (!response.ok) {
            throw new Error('Erro ao obter os dados do ranking');
          }
          return response.json();
        })
        .then(data => {
          console.log("dados:", data)
          nomeServ = []
          totalServ = []

          data.forEach(item => {

        
            nomeServ.push(item.servidor)
            totalServ.push(item.total_alertas)
          

          });


          plotarGrafico2(nomeServ, totalServ);
        })
        .catch(error => {
          console.error('Erro na requisição do ranking', error);
        });


    } else {
      compararButton.classList.remove("clicked");
      cont = 0;
    }


  }

  function analisar() {
    const tabela = document.getElementById('ranking');
    const compararButton = document.querySelector(".buttonRelatorioComparar");
    const analisarButton = document.querySelector(".buttonRelatorioAnalisar");
    const queryParams = gerarQueryParams();

    compararButton.classList.remove("clicked");

    if (cont == 0 || !analisarButton.classList.contains("clicked")) {
      analisarButton.classList.add("clicked");
      cont = 1;


      document.getElementById("divisao2").style.display = 'flex';
      document.getElementById("divisao2C").style.display = 'none';
      document.getElementById("DD").style.display = 'none';
      document.getElementById("DE").style.display = 'none';
      document.getElementById("grafico2").style.display = 'none';

      fetch(`/dashboard/analisar?${queryParams.toString()}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      })
        .then(response => {
          // Verifica
          if (!response.ok) {
            throw new Error('Erro ao obter os dados do ranking');
          }
          return response.json();
        })
        .then(data => {
          console.log("dados:", data)
          // Limpa o conteúdo atual do tbody
          tabela.innerHTML = '';

          // Loop pelos dados e criar as linhas da tabela
          //o tr define uma linha em uma tabela
          //o td cria uma célula da linha da tabela, ou seja, na horizontal.

          const componentesFormatados = {
            'cpu': 'CPU',
            'ram': 'RAM',
            'rede_enviada': 'Rede dados enviados',
            'rede_recebida': 'Rede dados recebidos'
          };
          data.forEach(item => {

            const linha = `<tr> 
                            <td>${item.servidor}</td>
                            <td>${componentesFormatados[item.componente]}</td>
                            <td>${item.total_alertas}</td>
                            <td>${item.valor_medio}</td>
                             <td>${item.mes}</td> 
                        </tr>`;
            tabela.innerHTML += linha;
          });
        })
        .catch(error => {
          console.error('Erro na requisição do ranking', error);
        });

      return false;


    } else {
      analisarButton.classList.remove("clicked");
      cont = 0;
    }

  }


  // document.addEventListener('DOMContentLoaded', Ranking);




  // Função para fazer a requisição e preencher o <select> com servidores
  async function servidor() {
    const empresa = sessionStorage.ID_EMPRESA;
    console.log('Iniciando a requisição para /dashboard/servidor');

    try {
      const response = await fetch(`/dashboard/servidor/${empresa}`, {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' },
      });

      console.log('Resposta recebida do servidor:', response);

      if (!response.ok) {
        throw new Error('Erro ao obter os dados: ' + response.statusText);
      }

      const data = await response.json();
      console.log('Dados brutos recebidos:', data);

      if (Array.isArray(data)) {

        const servidores = [];

        data.forEach(item => {
          servidores.push(item.identificacao);
        });

        const selectElement1 = document.getElementById("feriadoSelect");
        const selectElement2 = document.getElementById("servidorRelatorio");

        selectElement1.innerHTML = '';
        selectElement2.innerHTML = '';

        servidores.forEach(servidor => {
          const option1 = document.createElement('option');
          option1.value = servidor;
          option1.textContent = servidor;
          selectElement1.appendChild(option1);

          const option2 = document.createElement('option');
          option2.value = servidor;
          option2.textContent = servidor;
          selectElement2.appendChild(option2);
        });

        // Atualiza o selectpicker
        $('#servidorRelatorio').selectpicker('refresh'); // Atualiza o selectpicker
        console.log('Select de servidores preenchido com sucesso.');
      } else {
        console.error('Erro: A resposta não contém um array de servidores.');
      }
    } catch (error) {
      console.error('Erro na requisição', error);
    }

  }


  function obterServidorSelecionado() {
    const valorSelecionado = document.getElementById("feriadoSelect").value;

    // Se não houver um valor selecionado, usa o primeiro servidor automaticamente
    const servidor = valorSelecionado || document.getElementById("feriadoSelect").options[0].value;
    obterDadosGrafico(servidor);

  }



  // Função para obter os dados de períodos
  async function periodo() {
    const empresa = sessionStorage.ID_EMPRESA;
    console.log('Iniciando a requisição para /dashboard/periodo');

    try {
      // Verifique se a variável empresa está sendo recuperada corretamente
      if (!empresa) {
        throw new Error('ID_EMPRESA não encontrado em sessionStorage.');
      }

      const response = await fetch(`/dashboard/periodo/${empresa}`, {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' },
      });

      console.log('Resposta recebida sobre os períodos:', response);

      if (!response.ok) {
        throw new Error('Erro ao obter os dados: ' + response.statusText);
      }

      const data = await response.json();
      console.log('Dados brutos recebidos:', data);

      // Verifique se data é um array e se contém os itens esperados
      if (Array.isArray(data) && data.length > 0) {

        const meses = {
          "1": "Janeiro",
          "2": "Fevereiro",
          "3": "Março",
          "4": "Abril",
          "5": "Maio",
          "6": "Junho",
          "7": "Julho",
          "8": "Agosto",
          "9": "Setembro",
          "10": "Outubro",
          "11": "Novembro",
          "12": "Dezembro"
        };
        const periodos = [];
        data.forEach(item => {
          mes: periodos.push(meses[item.mes]);
        });
        const selectElement = document.getElementById("periodoRelatorio");
        selectElement.innerHTML = ''; // Limpa o conteúdo existente

        periodos.forEach(periodo => {
          const option = document.createElement('option');
          option.value = periodo;
          option.textContent = periodo;
          selectElement.appendChild(option);
        });

        // Atualiza o selectpicker
        $('#periodoRelatorio').selectpicker('refresh'); // Atualiza o selectpicker
        console.log('Select de períodos preenchido com sucesso.');

      } else {
        console.error('Erro: A resposta não contém um array de períodos válidos.');
      }

    } catch (error) {
      console.error('Erro na requisição de períodos', error);
    }
  }



  // Função para exibir o canvas do gráfico e iniciar o processo de obtenção de dados
  async function exibirPosts() {
    document.getElementById("grafico").innerHTML += `<canvas id="myChartCanvas"></canvas>`;
    document.getElementById("grafico2").innerHTML += `<canvas id="myChartCanvas2"></canvas>`;
    await obterDadosGrafico();
  }

  // Função para obter dados do gráfico com base no servidor selecionado
  async function obterDadosGrafico(valorSelecionado) {
    const empresa = sessionStorage.ID_EMPRESA;

    console.log('Obtendo dados para:', valorSelecionado, 'da empresa:', empresa);

    try {
      const response = await fetch(`/dashboard/feriado/${valorSelecionado}/${empresa}`, { cache: 'no-store' });
      if (response.ok) {
        const resposta = await response.json();
        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
        plotarGrafico(resposta);
      } else {
        console.error('Nenhum dado encontrado');
      }
    } catch (error) {
      console.error('Erro na obtenção dos dados para o gráfico:', error.message);
    }
  }

  var grafico
  var grafico2

  // Função para plotar o gráfico
  function plotarGrafico(resposta) {
    const labels = [];
    const dados = {
      labels: labels,
      datasets: [{
        label: 'Uso médio da CPU (%) durante os feriados',
        data: [],
        backgroundColor: [
          'rgba(30,144,255, 0.7)',
          'rgba(128,0,128, 0.7)',
          'rgba(255,0,0, 0.7)',
          'rgba(255,20,147, 0.7)',
          'rgba(186,85,211, 0.7)'
        ],
        borderColor: [
          'rgba(30,144,255, 1)',
          'rgba(128,0,128, 1)',
          'rgba(255,0,0, 1)',
          'rgba(255,20,147, 1)',
          'rgba(186,85,211, 1)'
        ],
        borderWidth: 2,
        tension: 0.1
      }]
    };

    const datasTraduzidas = {
      "2024-01-01": "Ano Novo",
      "2024-12-25": "Natal",
      "2024-03-29": "Sexta-feira Santa",
      "2024-03-31": "Páscoa",
      "2024-05-01": "Dia do Trabalho",
      "2024-09-07": "Dia da Independência",
      "2024-12-26": "Dia de Santo Estêvão",
      "2024-03-31": "Domingo de Páscoa",
      "2024-11-01": "Dia de Todos os Santos",
      "2024-05-30": "Dia da Ascensão",
      "2024-05-20": "Segunda-feira de Pentecostes",
      "2024-01-06": "Dia de Reis",
      "2024-08-15": "Assunção de Maria",
      "2024-02-13": "Carnaval",
      "2024-12-24": "Véspera de Natal",
      "2024-06-20": "Corpus Christi",
      "2024-12-31": "Véspera de Ano Novo",
      "2024-08-15": "Imaculada Conceição"
    };



    resposta.forEach(registro => {
      const dataFormatada = new Date(registro.dataRegistro).toISOString().split('T')[0];
      labels.push(datasTraduzidas[dataFormatada] || dataFormatada);
      dados.datasets[0].data.push(registro.mediaPercentualCPU);
    });

    const config = {
      type: 'bar',
      data: dados,
      options: {
        scales: {
          y: {
            title: {
              display: true,
              text: 'Uso médio do percentual da CPU'
            }
          }
        },
        plugins: {
          legend: {
            display: true,
            displayColors: false,
            labels: {
              usePointStyle: true,
              boxWidth: 0,
              fontColor: 'transparent'
            }
          }
        },
      }
    };

    if (grafico) {
      grafico.destroy();
    }

    // Adiciona o gráfico à tela
    grafico = new Chart(document.getElementById('myChartCanvas'), config);

  }

  function plotarGrafico2(nomeServ, totalServ) {
    const labels = nomeServ;
    const dados = {
      labels: labels,
      datasets: [{
        label: 'Comparação da quantidade de alertas por servidor',
        data: totalServ,
        backgroundColor: [
          'rgba(30,144,255, 0.7)',
          'rgba(128,0,128, 0.7)'
        ],
        borderColor: [
          'rgba(30,144,255, 1)',
          'rgba(128,0,128, 1)'
        ],
        borderWidth: 2
      }]
    };

    const config2 = {
      type: 'pie',
      data: dados,
      options: {
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              font: {
                size: 14
              },
              color: '#333'
            }
          },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.raw || 0;
              const percentage = ((value / totalServ.reduce((a, b) => a + b, 0)) * 100).toFixed(2);
              return `${label}: ${value} alertas (${percentage}%)`;
            }
          },
          }
        }
      }
    };

    // Verifica se existe um gráfico anterior e destrói para evitar duplicatas
    if (grafico2) {
      grafico2.destroy();
    }

    // Renderiza o novo gráfico no canvas
    grafico2 = new Chart(document.getElementById('myChartCanvas2'), config2);
  }





  // Chama a função para fazer a requisição inicial e preencher o select
  async function inicializar() {
    await servidor(); // Preenche os servidores
    await periodo(); // Preenche os períodos
    await exibirPosts(); // Exibe o gráfico
    obterServidorSelecionado();
  }

  // Inicia o processo
  inicializar();

</script>